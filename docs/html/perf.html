<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mackey: Performance</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Mackey
   &#160;<span id="projectnumber">V3.1</span>
   </div>
   <div id="projectbrief">A C++ library for computing RO(G) graded homology</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('perf.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Performance </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#compoptions">Compiler Options</a></li>
<li class="level1"><a href="#thread">Multithreading</a></li>
<li class="level1"><a href="#densevssparse">Dense vs Sparse</a></li>
<li class="level1"><a href="#boxproducts">Box Products</a></li>
</ul>
</div>
<div class="textblock"><p>First, two heuristic observations:</p>
<ul>
<li>The Linux binaries runs measurably faster than the Windows one.</li>
<li>Out of the three compilers on Linux tested (GCC, Clang, ICC), Clang seems to produce faster code.</li>
</ul>
<h1><a class="anchor" id="compoptions"></a>
Compiler Options</h1>
<ul>
<li>I recommend the following compiler options (GCC, Clang): <code>-O3 -march=native </code></li>
<li>For safety you can use -fsanitize=signed-integer-overflow that checks for integer overflow at minimum performance cost. For extra safety, -fsanitize=integer checks all kinds of unwanted integer behavior (eg unsigned overflow) at a slightly higher cost. More generally -fsanitize=undefined can be used to check for all undefined behavior (and more) at a much greater performance hit (about 10x slower).</li>
<li>See this <a href=" http://eigen.tuxfamily.org/index.php?title=Main_Page#Compiler_support">page</a> for compiler options regarding Eigen.</li>
<li>If OpenMP support is desired use <code>-fopenmp</code>.</li>
</ul>
<h1><a class="anchor" id="thread"></a>
Multithreading</h1>
<ul>
<li>The main algorithms of the program are single-threaded, with the idea being that they will be performed in loops, computing the answer in a range (which is required for the identification algorithms to then work). Multithreading these loop iterations with openMP is turned on by default in the <code>AdditiveStructure</code> and <code>Factorization</code> code, using the maximum amount of threads available. But note that other parts of the library (using <code>std::map</code>) are not thread-safe and need to be locked; thankfully these have almost no bearing on performance.</li>
<li>There is one caveat: While the loop iterations are independent, they are not all equally computationally intensive. A sphere like \(S^{2\sigma+\lambda}\) is cheaper to compute compared to \(S^{6\sigma+8\lambda}\) which is in turn much cheaper compared to \(S^{6\sigma-8\lambda}\) as the latter one involves a box product. In the multiplicative structure we may have to take double box products, and these are even more expensive in run-time as they involve arbitrarily large permutation matrices.</li>
<li>So it's important to equally divide the work among the threads. Currently this has to be done manually on the user's end.</li>
</ul>
<h1><a class="anchor" id="densevssparse"></a>
Dense vs Sparse</h1>
<ul>
<li>Dense matrices are faster than sparse matrices as long as they don't get too large.</li>
<li>When matrices do get large, sparse matrices not only offer better performance, but huge savings in memory (30x and above). When triple box products are used in combination with dense matrices and multithreading, memory usage can go up to 60GB, hitting the swap file and slowing the program to a crawl. In that case we can see up to 20x speedup when using sparse matrices. The Intel MKL is not any faster than Eigen for sparse matrix multiplication.</li>
</ul>
<h1><a class="anchor" id="boxproducts"></a>
Box Products</h1>
<p>Box products involve some very large matrices, and the more iterated box products we use the higher that complexity.</p>
<ul>
<li><p class="startli">For the additive structure we only need to take one box product:</p>
<p class="startli">\(C_*(S^V)=C_*(S^{V_{pos}})\otimes C_*(S^{-V_{neg}})=C_*(S^{V_{pos}})\otimes C^{-*}(S^{V_{neg}})\)</p>
</li>
</ul>
<p>where \(V=V_{pos}-V_{neg}\)</p>
<ul>
<li>For the multiplicative structure we need to take an extra box product, so up to three total when computing \(ab\) for \(a,b\) in the mixed homology.</li>
<li>For factorization we would also need three box products. But by design, we are only multiplying with certain basic irreducibles (Euler and orientation classes) and hope everything else is obtained like this. By selecting them to be in the pure co/homology (which the Euler and orientation classes always are) we can reduce this to two box products total. If extra identification needed then we do take triple box products, incurring a massive performance and memory cost.</li>
<li>For Massey products we need an extra two box products, so up to five total then computing \(\langle a,b,c\rangle \) for \(a,b,c\) in the mixed homology. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.18-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
